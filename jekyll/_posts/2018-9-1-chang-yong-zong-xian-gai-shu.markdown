---
layout: post
title: 常用总线概述
date: 2018-09-01 09:55:08 +0800
categories: 硬件
issue_id: 39
---

# 概述
机器人上常用的总线不外乎：CAN、RS232、RS485、I2C、SPI、UART（TTL电平）等

其中，以平衡传输和不平衡传输作为区别的话：

- 平衡传输包括：CAN、RS485
- 不平衡传输包括：RS232、I2C、SPI、UART（TTL）

平衡传输，又叫差分传输方式。指一个信号经过调制后，由两条信号线的电压差来表示，因此平衡传输一般不需要地线。

不平衡传输，又叫单端通讯。是指信号传输线的有一个输入端，一个地线，信号线的电平以地线作为参考。因此，**不平衡传输一般需要共地。**

以传输距离来划分：

- 板间通信：CAN、RS232、RS485
- 芯片间通信：I2C、SPI、UART（TTL）


以有没有时钟线（**SCLK**）划分：
- 无时钟线：CAN、RS232、RS485、UART（TTL）
- 有时钟线：I2C、SPI

**没有时钟信号线的通信协议，一般通信双方需要约定一个波特率来进行通信。** CAN总线常见波特率为1Mbps、500kbps，串口协议常见波特率为115200、9600、38400、57600bps等。

至于有时钟信号线的协议，通信速度即取决于时钟线的频率。

## CAN
> CAN是控制器局域网络(Controller Area Network,
> CAN)的简称，是由以研发和生产汽车电子产品著称的德国BOSCH公司开发的，并最终成为国际标准（ISO
> 11898），是国际上应用最广泛的现场总线之一。
> 在北美和西欧，CAN总线协议已经成为汽车计算机控制系统和嵌入式工业控制局域网的标准总线，并且拥有以CAN为底层协议专为大型货车和重工机械车辆设计的J1939协议。

### 物理层
CAN总线有CANH与CANL两条信号线组成，电平为5V，要求CANH与CANL两端阻抗为**60Ω**，因此一般在使用CAN通信的电路板上，会有一个**120Ω**电阻与跳线帽。跳线帽用于选择是否将**120Ω**电阻接入电路。

**请思考，为什么是120Ω电阻？**

### 拓扑结构
![CAN常见拓扑结构，所有节点的CANH连在一起，CANL连在一起][1]

### CAN控制器、收发器（驱动器）
- CAN控制器用于实现CAN总线的协议底层以及数据链路层，此外还需要进行冲突判断、错误处理等诸多任务。如果一个单片机说自己支持CAN总线，那么其指的是内部包含了CAN控制器，引脚表示为CAN_RX、CAN_TX。

- CAN收发器（有时也称为驱动器）是CAN总线的物理层，用于将二进制码流转换为差分信号发送，将差分信号转换为二进制码流接收。即单片机输出的RX、TX信号，经由收发器（常使用**TJA1050**），转化为实际电路中CANH、CANL的电压差。

![CAN硬件构成][2]


## 串口协议
串口协议包含较多，常见有RS232、RS485、UART（TTL）等。

### RS232
信号电平：+-12V，因此如果单片机需要进行RS232通信，一般需要一个芯片来进行电平的转换。常用芯片为MAX232。

### RS485
信号电平：+-2~6V，也需要芯片，常用MAX485。需要注意的是，RS485与CAN类似，信号由两条信号线的电压差表示，因此**无须共地**。

### UART（TTL）
单片机上的串口，信号电平：0-3.3V（5V，取决于单片机可忍受电压）

## I2C

## SPI


  [1]: https://raw.githubusercontent.com/Ncerzzk/MyBlog/master/img/canbus.jpg
  [2]: https://raw.githubusercontent.com/Ncerzzk/MyBlog/master/img/canbus2.jpg