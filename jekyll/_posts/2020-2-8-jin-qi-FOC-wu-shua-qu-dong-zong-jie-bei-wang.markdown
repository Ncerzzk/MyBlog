---
layout: post
title: 近期FOC无刷驱动总结备忘
date: 2020-02-08 14:32:02 +0800
categories: 技术 硬件
issue_id: 74
---

由于最近遇到了硬件上的问题，但在日本这边估计解决不了，因此无刷驱动这一块估计又得暂时搁置了。

遇到的问题与电流采样有关，INA181感觉工作一直不正常。首先，电流测量应该是双向的，但即使我改成了双向的，
ADC出来依旧不太对。

无论是TIM8的TRGO触发，还是用TIM1的CC1触发。之前是因为TIM8触发一直不行，后来加上了TIM1和TIM8同步，但依旧不行。
所以问题可能不在TIM1或者TIM8上。

而且在电机运转的时候，我用手稍微堵转一下电机，电流却没有升高。这就非常的诡异了。

所以目前来说，电流采样硬件上还有一些问题，这里记录一下之后要改的东西，可能回国之后再改改看。

- 增加电源电压采样（测量电阻和电感需要用到）
- INA181的REF需要换成电压跟随器或者高精度的基准电压源
  - 现在是直接用两个电阻串联，这样根本不能作为基准电压（输出阻抗太大）
  - 改成DAC也似乎不太行，不知道为什么
  
目前对改板子的修改：
- 增加了电源电压采样
- 用运放设计了一个电压跟随器作为INA181的基准电压
- 修改TIM8输出SVPWM为TIM1输出
- 增加USB接口（DP、DM）
- CAN引脚修改，因为PA11 PA12被USB占用


