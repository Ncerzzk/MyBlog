---
layout: post
title: 近期硬件上的设计失误记录
date: 1970-01-01 08:00:00 +0800
categories: 技术 硬件
issue_id: 164
---

## 飞控板的开关电路问题(V1.1)

### 问题导致
 - 开关失效，开关未作用，不该导通的地方就导通了
 - 开关瞬间会烧单片机，要嘛烧飞控的，要嘛烧驱动板的
  
### 原因分析

电路中有两个地，电池地和开关后的地（简称开关地）

飞控上的大部分芯片都是连接到开关地（直接或者通过0R电阻）开关地由开关，控制MOS导通来控制开关地是否接入电池地，开关地用来给驱动板供电

而飞控和驱动板之间通过SCK,CSN,MO,MI,G，连接在一起。这里的G是飞控的开关地。由于SCK这些引脚内部是连到单片机中的，实际上相当于这些引脚经过一个二极管反向连接到单片机地（即电池地），因此将飞控和驱动板连接后，即使开关没有作用，电池地和开关地也会几乎连在一起。几乎的意思是说是由两边单片机的二级管导致的等效连在一起。而一旦打开开关，开关地会连到电池地上，导致电压有个突变，这个突变就容易将单片机烧了。

实测烧了3片f405

相关电路：

![此处输入图片的描述][1]

[1]: https://raw.githubusercontent.com/Ncerzzk/MyBlog/master/img/shiwu1.jpg
![此处输入图片的描述][2]

[2]: https://raw.githubusercontent.com/Ncerzzk/MyBlog/master/img/shiwu2.jpg

错误分析原理图：
![此处输入图片的描述][3]

[3]: https://raw.githubusercontent.com/Ncerzzk/MyBlog/master/img/shiwufenxi.jpg

## 驱动板与飞控板通信期间，SPI频繁受到干扰

SPI受到干扰后的软件恢复方式在上篇文章已经说了，但是由于硬件上的问题，导致受到干扰的频率比正常情况下大得多，即使可以通过软件上恢复，也极大影响了电机的正常运行。

原因主要是：SPI通信接口的地连到了功率地上，导致电机电流一变化，就容易干扰SPI正常通信

解决方式比较简单，在PCB上割断原来连到PGND上的线，刚好该引脚附近就有信号地的铜皮，直接将其刮开，然后短上即可。飞控板一侧同理。


