<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Ardupilot中新增beacon设备 | Huangzzk’s Blog</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Ardupilot中新增beacon设备" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="ardupilot的串口与beacon大致情况在之前都写过了。这里不再赘述，直接写我新增的INF（无穷未来）的驱动手册吧。" />
<meta property="og:description" content="ardupilot的串口与beacon大致情况在之前都写过了。这里不再赘述，直接写我新增的INF（无穷未来）的驱动手册吧。" />
<link rel="canonical" href="https://ncerzzk.github.io/%E6%8A%80%E6%9C%AF/2019/04/02/Ardupilot-zhong-xin-zeng-beacon-she-bei.html" />
<meta property="og:url" content="https://ncerzzk.github.io/%E6%8A%80%E6%9C%AF/2019/04/02/Ardupilot-zhong-xin-zeng-beacon-she-bei.html" />
<meta property="og:site_name" content="Huangzzk’s Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-04-02T16:15:52+08:00" />
<script type="application/ld+json">
{"@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://ncerzzk.github.io/%E6%8A%80%E6%9C%AF/2019/04/02/Ardupilot-zhong-xin-zeng-beacon-she-bei.html"},"url":"https://ncerzzk.github.io/%E6%8A%80%E6%9C%AF/2019/04/02/Ardupilot-zhong-xin-zeng-beacon-she-bei.html","headline":"Ardupilot中新增beacon设备","dateModified":"2019-04-02T16:15:52+08:00","datePublished":"2019-04-02T16:15:52+08:00","description":"ardupilot的串口与beacon大致情况在之前都写过了。这里不再赘述，直接写我新增的INF（无穷未来）的驱动手册吧。","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://ncerzzk.github.io/feed.xml" title="Huangzzk's Blog" /><script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?9a0d201458675d03a87e467407e4889b";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


</head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Huangzzk&#39;s Blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/aboutme/">关于</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <style type="text/css">
.css_btn_class {
	font-size:16px;
	font-family:Arial;
	font-weight:normal;
	-moz-border-radius:8px;
	-webkit-border-radius:8px;
	border-radius:8px;
	border:1px solid #dcdcdc;
	padding:9px 18px;
	text-decoration:none;
	background:-webkit-gradient( linear, left top, left bottom, color-stop(5%, #ffffff), color-stop(100%, #f6f6f6) );
	background:-moz-linear-gradient( center top, #ffffff 5%, #f6f6f6 100% );
	background:-ms-linear-gradient( top, #ffffff 5%, #f6f6f6 100% );
	filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#ffffff', endColorstr='#f6f6f6');
	background-color:#ffffff;
	color:#666666;
	display:inline-block;
	text-shadow:1px 1px 0px #ffffff;
 	-webkit-box-shadow:inset 1px 1px 0px 0px #ffffff;
 	-moz-box-shadow:inset 1px 1px 0px 0px #ffffff;
 	box-shadow:inset 1px 1px 0px 0px #ffffff;
}.css_btn_class:hover {
	background:-webkit-gradient( linear, left top, left bottom, color-stop(5%, #f6f6f6), color-stop(100%, #ffffff) );
	background:-moz-linear-gradient( center top, #f6f6f6 5%, #ffffff 100% );
	background:-ms-linear-gradient( top, #f6f6f6 5%, #ffffff 100% );
	filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#f6f6f6', endColorstr='#ffffff');
	background-color:#f6f6f6;
}.css_btn_class:active {
	position:relative;
	top:1px;
}

.comment_username{
font-size:14px;
margin-left:5px;
}
.comment_time{
font-size:14px;	
	float:right;
	margin-right:5px;
}
.comment{
	list-style:none;
}
.comment_username{
	color: #24292e;
	text-decoration: none;
	}
	.comment_user_img{
	float:left;
}
.comment_box{
	margin-left:40px;
    color: #24292e;
    background-color: #fff;
    border: 1px solid #d1d5da;
    border-radius: 3px;
}
.comment_content{
margin:10px 10px 10px 10px;
}

#comment{
	margin-top:30px;
}

.comment{
	margin-top:30px;
}

/* CSS按钮生成器 */
</style>

<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Ardupilot中新增beacon设备</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2019-04-02T16:15:52+08:00" itemprop="datePublished">Apr 2, 2019
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>ardupilot的串口与beacon大致情况在之前都写过了。这里不再赘述，直接写我新增的INF（无穷未来）的驱动手册吧。</p>

<h3 id="加入驱动文件">加入驱动文件</h3>
<p>在AP_Beacon文件夹中，加入AP_Beacon_Frompi.cpp 及相应的头文件。</p>

<h3 id="增加beacon设备枚举">增加Beacon设备枚举</h3>
<p>在AP_Beacon.h文件中，增加AP_BeaconType的枚举成员，这里命名为了AP_BeaconType_INF，值为3。</p>

<p>在var_info数组中，修改_TYPE常量的值，改为3，即使用AP_BeaconType_INF。</p>

<p>_LATITUDE 和 _LONGITUDE 可以在这里直接设置，也可以在MP里设置。</p>

<h3 id="增加串口协议枚举">增加串口协议枚举</h3>
<p>在AP_SerialManager.h中，增加SerialProtocol的枚举成员，这里命名为SerialProtocol_UWB_INF，值为20。</p>

<p>在在AP_SerialManager.cpp中init()函数下，增加新枚举成员的case：</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>				case SerialProtocol_UWB_INF: // add by huangcanming in 2019.3.13
				case SerialProtocol_UWB: // ad by huangcanming in 2019.3.12 ,this is just for test
					state[i].uart-&gt;begin(map_baudrate(state[i].baud),
                	               256,
                	               128);
					break;
</code></pre></div></div>

<h3 id="指定inf使用的串口">指定INF使用的串口</h3>
<p>在AP_SerialManager的var_info数组初始化中，修改串口3的协议为SerialProtocol_UWB_INF，波特率为921。</p>

<p>串口3是原GPS的使用串口，因为用UWB代替GPS了，因此直接替代掉。</p>

<p>各个串口的说明：</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    state[1].uart = hal.uartC;  // serial1, uartC, normally telem1
    state[2].uart = hal.uartD;  // serial2, uartD, normally telem2
    state[3].uart = hal.uartB;  // serial3, uartB, normally 1st GPS
    state[4].uart = hal.uartE;  // serial4, uartE, normally 2nd GPS
    state[5].uart = hal.uartF;  // serial5, DEBUG
</code></pre></div></div>

<h3 id="其他参数设置">其他参数设置</h3>
<ul>
  <li>设置初始经纬度</li>
  <li>AHRS_EKF_TYPE 设置为3 使用EKF3</li>
  <li>EK3_ENABLE 设置为1</li>
  <li>BCN_ORIENT_YAW 必须设置，否则坐标系是倾斜的，走直线变成斜线。
设置方式：
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>One way to capture this value is to stand at the origin holding the vehicle so that it’s nose points towards the second beacon. Read the vehicle’s heading from the HUD and enter this value into
</code></pre></div>    </div>
  </li>
</ul>


  </div><!--
	<a href="https://github.com/Ncerzzk/Myblog/issues/53" class="css_btn_class">添加留言</a>
	-->
	
<div id="comment">
<li class="comment">
	
	<img class="comment_user_img"  height="40" width="40" src="https://avatars2.githubusercontent.com/u/9284611?v=4"></img>
	<div class="comment_box">
	<a class="comment_username" href="#">Username</a>
	<span class="comment_time">Comment at 2019.5.13</span>
	<div class="comment_content">Here is the Content</div>
	</div>
</li>
</div>
		
	
  <a class="u-url" href="/%E6%8A%80%E6%9C%AF/2019/04/02/Ardupilot-zhong-xin-zeng-beacon-she-bei.html" hidden></a>
</article>

<script src="https://cdn.staticfile.org/jquery/2.0.0/jquery.min.js">
</script>

<script>

$(document).ready(function(){
  $("button").click(function(){
    $(this).hide();
  });
});
var h=$("#comment").html();
var user="Ncerzzk";
var repo="Myblog";
var issueid="53";
$("#comment").html("");
$.getJSON("https://api.github.com/repos/"+user+"/"+repo+"/issues/"+issueid+"/comments", function(json){
  for(i in json){
	  $("#comment").append(h);
	  $(".comment_username:last").text(json[i].user.login);
	  $(".comment_username:last").attr("href",json[i].user.html_url);
	  $(".comment_content:last").text(json[i].body);
	  $(".comment_time:last").text(json[i].created_at);
	  $(".comment_user_img:last").attr("src",json[i].user.avatar_url);
  }
});
</script>


      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Huangzzk&#39;s Blog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Huangzzk&#39;s Blog</li><li><a class="u-email" href="mailto:e.255mail#gmail.com">e.255mail#gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/Ncerzzk"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">Ncerzzk</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Hello,world!</p>
      </div>
    </div>
	<div>
		<a href="http://beian.miit.gov.cn/">闽ICP备20002143号</a>
	</div>
  </div>

</footer>
</body>
<script>
  window.onload=function (){
    var content = document.getElementsByTagName("html")[0].innerHTML;
    content = content.replace(/博客|Blog|blog/g,"");
    console.log(content);

    document.getElementsByTagName("html")[0].innerHTML = content; 
  }
</script>
</html>
